# Backend Requests ‚Äî –û—Ç—á—ë—Ç –æ –ø—Ä–æ–¥–µ–ª–∞–Ω–Ω–æ–π —Ä–∞–±–æ—Ç–µ

**–î–∞—Ç–∞:** 2026-02-16  
**–°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã:** [BACKEND_API_DOCS.md](./BACKEND_API_DOCS.md)

---

## 1. –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ä–æ–ª–µ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

**–°—Ç–∞—Ç—É—Å:** ‚úÖ done  
**–§–∞–∑–∞:** 6 ¬∑ –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: –≤—ã—Å–æ–∫–∏–π

### –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ

–ë–µ–∫–µ–Ω–¥ —Ç–µ–ø–µ—Ä—å –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –Ω–∞–±–æ—Ä —Ä–æ–ª–µ–π:

```go
role: "user" | "agent" | "agency" | "developer" | "admin"
```

- `agent` ‚Äî –∞–≥–µ–Ω—Ç –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏ (—Ñ–∏–∑–ª–∏—Ü–æ)
- `agency` ‚Äî –∞–≥–µ–Ω—Ç—Å—Ç–≤–æ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏ (–æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è)  
- `developer` ‚Äî –∑–∞—Å—Ç—Ä–æ–π—â–∏–∫

### –ò–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

- `internal/domain/user/entity.go` ‚Äî –¥–æ–±–∞–≤–ª–µ–Ω—ã –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã `RoleAgent`, `RoleAgency`, `RoleDeveloper`, —Ñ—É–Ω–∫—Ü–∏—è `IsValidRole()`, –º–∞—Å—Å–∏–≤ `ValidRoles`
- `internal/delivery/http/v1/user/handler.go` ‚Äî –æ–±–Ω–æ–≤–ª—ë–Ω swagger Enum –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞ –ø–æ —Ä–æ–ª–∏

### –ß—Ç–æ –Ω—É–∂–Ω–æ –∑–Ω–∞—Ç—å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥—É

- –ü—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –ø–æ–ª—É—á–∞–µ—Ç —Ä–æ–ª—å `"user"`
- –†–æ–ª—å –º–æ–∂–Ω–æ —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å —á–µ—Ä–µ–∑ `GET /api/v1/users?role=agent`
- `UserResponse.role` —Ç–µ–ø–µ—Ä—å –º–æ–∂–µ—Ç –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å: `"user"`, `"agent"`, `"agency"`, `"developer"`, `"admin"`

---

## 2. –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ Search Tabs –∏ Saved Filters

**–°—Ç–∞—Ç—É—Å:** ‚úÖ done  
**–§–∞–∑–∞:** 5 ¬∑ –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: –≤—ã—Å–æ–∫–∏–π

### –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ

–î–æ–±–∞–≤–ª–µ–Ω–∞ —Å–≤—è–∑—å –º–µ–∂–¥—É –≤–∫–ª–∞–¥–∫–∞–º–∏ –ø–æ–∏—Å–∫–∞ –∏ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–º–∏ —Ñ–∏–ª—å—Ç—Ä–∞–º–∏ —á–µ—Ä–µ–∑ –ø–æ–ª–µ `filterId`:

- `SearchTab` entity —Ç–µ–ø–µ—Ä—å —Å–æ–¥–µ—Ä–∂–∏—Ç `FilterID *uuid.UUID`
- `TabResponse` —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–æ–ª–µ `filterId` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ)

### –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. **–¢–∞–±—ã —É–∂–µ —Ö—Ä–∞–Ω—è—Ç —Ñ–∏–ª—å—Ç—Ä—ã inline** ‚Äî –ø–æ–ª–µ `filters: Record<string, any>` –≤ `TabResponse` —Å–æ–¥–µ—Ä–∂–∏—Ç JSON —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ —Ñ–∏–ª—å—Ç—Ä–∞, —Ç–∞–∫ —á—Ç–æ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏—Ö –Ω–∞–ø—Ä—è–º—É—é
2. **–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Å–≤—è–∑—å —á–µ—Ä–µ–∑ `filterId`** ‚Äî –µ—Å–ª–∏ —Ç–∞–± –±—ã–ª —Å–≤—è–∑–∞–Ω —Å —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–º —Ñ–∏–ª—å—Ç—Ä–æ–º, –µ–≥–æ ID –¥–æ—Å—Ç—É–ø–µ–Ω –≤ –ø–æ–ª–µ `filterId`
3. –ü—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Ç–∞–±–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –ø–æ–ª—É—á–∞–µ—Ç –∏ `filters` inline, –∏ `filterId` –¥–ª—è —Å—Å—ã–ª–∫–∏ –Ω–∞ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–π —Ñ–∏–ª—å—Ç—Ä

### TabResponse (–æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π)

```typescript
interface TabResponse {
  id: string;
  userId: string;
  folderId?: string;
  filterId?: string;        // ‚Üê –ù–û–í–û–ï: ID —Å–≤—è–∑–∞–Ω–Ω–æ–≥–æ —Ñ–∏–ª—å—Ç—Ä–∞
  title: string;
  filters: Record<string, any>;  // —Ñ–∏–ª—å—Ç—Ä—ã inline (–∫–∞–∫ —Ä–∞–Ω—å—à–µ)
  // ...–æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø–æ–ª—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
}
```

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è –¥–ª—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞

- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `filters` inline –¥–ª—è –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è query string –ø—Ä–∏ –ø–æ–∏—Å–∫–µ
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `filterId`, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–π —Ñ–∏–ª—å—Ç—Ä —á–µ—Ä–µ–∑ `/api/v1/filters/:id`

---

## 3. Autosearch: —Ä–µ–∂–∏–º "online" (realtime)

**–°—Ç–∞—Ç—É—Å:** ‚úÖ done  
**–§–∞–∑–∞:** 6 ¬∑ –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: —Å—Ä–µ–¥–Ω–∏–π

### –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ

–î–æ–±–∞–≤–ª–µ–Ω —Ä–µ–∂–∏–º `"online"` –≤ `send_frequency`:

```
send_frequency: "online" | "instant" | "daily" | "weekly"
```

### –ò–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

- `internal/domain/autosearch/entity.go` ‚Äî –¥–æ–±–∞–≤–ª–µ–Ω–∞ –∫–æ–Ω—Å—Ç–∞–Ω—Ç–∞ `NotificationFrequencyOnline`
- `internal/delivery/http/v1/autosearch/dto.go` ‚Äî –æ–±–Ω–æ–≤–ª–µ–Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è (`oneof=online instant daily weekly`)
- `internal/delivery/http/v1/filter/dto.go` ‚Äî –æ–±–Ω–æ–≤–ª–µ–Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è `notificationFrequency` –≤ `CreateFilterRequest` –∏ `UpdateFilterRequest`

### –ß—Ç–æ –Ω—É–∂–Ω–æ –∑–Ω–∞—Ç—å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥—É

- –ü—Ä–∏ `send_frequency: "online"` –±–µ–∫–µ–Ω–¥ –±—É–¥–µ—Ç –ø—É—à–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —á–µ—Ä–µ–∑ WebSocket-–∫–∞–Ω–∞–ª `autosearch:user_{userId}`
- –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å offline ‚Äî fallback –Ω–∞ push/telegram
- –§—Ä–æ–Ω—Ç–µ–Ω–¥ –º–æ–∂–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å:

```json
POST /api/v1/autosearch
{
  "filter_id": "...",
  "name": "–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏",
  "notification_channels": ["push", "telegram"],
  "send_frequency": "online",
  "is_active": true
}
```

---

## 4. –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –∞—Ç—Ä–∏–±—É—Ç–æ–≤ –æ–±—ä–µ–∫—Ç–∞ –ø–æ —Å–µ–∫—Ü–∏—è–º

**–°—Ç–∞—Ç—É—Å:** ‚úÖ done (—É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ)  
**–§–∞–∑–∞:** 2 ¬∑ –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: —Å—Ä–µ–¥–Ω–∏–π

### –û—Ç–≤–µ—Ç

**–î–∞, –±–µ–∫–µ–Ω–¥ —É–∂–µ –≥—Ä—É–ø–ø–∏—Ä—É–µ—Ç –∞—Ç—Ä–∏–±—É—Ç—ã –ø–æ —Å–µ–∫—Ü–∏—è–º.** `PropertyDetails` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∞—Ç—Ä–∏–±—É—Ç—ã –≤ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –º–∞—Å—Å–∏–≤–∞—Ö:

```typescript
interface PropertyDetails {
  // ...
  building_info: Attribute[];        // –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∑–¥–∞–Ω–∏–∏
  estate_info: Attribute[];          // –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –æ–±—ä–µ–∫—Ç–µ
  energy_efficiency: Attribute[];    // –≠–Ω–µ—Ä–≥–æ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
  characteristics: Attribute[];      // –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ (–ø–ª–æ—â–∞–¥—å, —ç—Ç–∞–∂, –∫–æ–º–Ω–∞—Ç—ã)
  amenities: Attribute[];            // –£–¥–æ–±—Å—Ç–≤–∞ (–±–∞—Å—Å–µ–π–Ω, –ø–∞—Ä–∫–æ–≤–∫–∞)
  tenant_preferences: Attribute[];   // –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –∞—Ä–µ–Ω–¥–∞—Ç–æ—Ä–∞–º
  tenants: Attribute[];              // –ê—Ä–µ–Ω–¥–∞—Ç–æ—Ä—ã
  // ...
}
```

`PropertyEnrichedListing` —Ç–∞–∫–∂–µ —Å–æ–¥–µ—Ä–∂–∏—Ç:

```typescript
interface PropertyEnrichedListing extends PropertyShortListing {
  characteristics: Attribute[];
  amenities: Attribute[];
  tenant_preferences: Attribute[];
  tenants: Attribute[];
  short_description: string;
}
```

### –§–æ—Ä–º–∞—Ç Attribute

```typescript
interface Attribute {
  label: string;     // –ø–µ—Ä–µ–≤–µ–¥—ë–Ω–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ
  value: string;     // –∫–æ–¥ (–Ω–∞–ø—Ä. "has_elevator")
  icon_type: string; // —Ç–∏–ø –∏–∫–æ–Ω–∫–∏
}
```

–§—Ä–æ–Ω—Ç–µ–Ω–¥ –º–æ–∂–µ—Ç —Ä–µ–Ω–¥–µ—Ä–∏—Ç—å –∫–∞–∂–¥—É—é —Å–µ–∫—Ü–∏—é –æ—Ç–¥–µ–ª—å–Ω–æ.

---

## 5. –ì–µ–æ–º–µ—Ç—Ä–∏–∏ –¥–ª—è –Ω–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

**–°—Ç–∞—Ç—É—Å:** ‚úÖ done  
**–§–∞–∑–∞:** 5 ¬∑ –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: —Å—Ä–µ–¥–Ω–∏–π

### –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ

–î–æ–±–∞–≤–ª–µ–Ω—ã —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –≥–µ–æ–º–µ—Ç—Ä–∏—è–º–∏ –±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:

| –ú–µ—Ç–æ–¥ | –ü—É—Ç—å | Auth | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|------|------|----------|
| `POST` | `/filters/guest/geometry` | ‚ùå | –°–æ–∑–¥–∞—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—É—é guest-–≥–µ–æ–º–µ—Ç—Ä–∏—é |
| `GET` | `/filters/guest/geometry/:id` | ‚ùå | –ü–æ–ª—É—á–∏—Ç—å guest-–≥–µ–æ–º–µ—Ç—Ä–∏—é –ø–æ ID |
| `DELETE` | `/filters/guest/geometry/:id` | ‚ùå | –£–¥–∞–ª–∏—Ç—å guest-–≥–µ–æ–º–µ—Ç—Ä–∏—é |

### –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤

```bash
# –°–æ–∑–¥–∞—Ç—å guest-–≥–µ–æ–º–µ—Ç—Ä–∏—é (–ø–æ–ª–∏–≥–æ–Ω)
POST /api/v1/filters/guest/geometry
{
  "geometry": "{\"type\":\"Polygon\",\"coordinates\":[[[-3.71,40.42],[-3.69,40.42],[-3.69,40.41],[-3.71,40.41],[-3.71,40.42]]]}"
}

# –û—Ç–≤–µ—Ç (201)
{
  "data": {
    "id": "geom-uuid",
    "filter_id": "00000000-0000-0000-0000-000000000000",
    "geometry": "{\"type\":\"Polygon\",\"coordinates\":[...]}",
    "created_at": "2026-02-16T12:00:00Z"
  }
}

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ –ø–æ–∏—Å–∫–µ
GET /api/v1/properties/short-listing?polygon_ids=geom-uuid

# –ü–æ–ª—É—á–∏—Ç—å –≥–µ–æ–º–µ—Ç—Ä–∏—é
GET /api/v1/filters/guest/geometry/geom-uuid

# –£–¥–∞–ª–∏—Ç—å
DELETE /api/v1/filters/guest/geometry/geom-uuid
```

### –ß—Ç–æ –Ω—É–∂–Ω–æ –∑–Ω–∞—Ç—å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥—É

- Guest-–≥–µ–æ–º–µ—Ç—Ä–∏–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è —Å `filter_id = "00000000-0000-0000-0000-000000000000"` (nil UUID)
- –í–æ–∑–≤—Ä–∞—â—ë–Ω–Ω—ã–π `id` –≥–µ–æ–º–µ—Ç—Ä–∏–∏ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ `polygon_ids` –¥–ª—è –ø–æ–∏—Å–∫–∞ –æ–±—ä–µ–∫—Ç–æ–≤
- Guest-–≥–µ–æ–º–µ—Ç—Ä–∏–∏ –¥–æ—Å—Ç—É–ø–Ω—ã –±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- –î–ª—è —Å–ª–æ–∂–Ω—ã—Ö –≥–µ–æ–º–µ—Ç—Ä–∏–π (–Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–æ–ª–∏–≥–æ–Ω–æ–≤) –º–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ guest-–≥–µ–æ–º–µ—Ç—Ä–∏–π –∏ –ø–µ—Ä–µ–¥–∞—Ç—å –∏—Ö —á–µ—Ä–µ–∑ `polygon_ids=uuid1,uuid2`

---

## 6. Favorites: –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ –ø–æ–ª—è

**–°—Ç–∞—Ç—É—Å:** ‚úÖ done  
**–§–∞–∑–∞:** 6 ¬∑ –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: –Ω–∏–∑–∫–∏–π

### PropertyNote

–í—Å–µ –ø–æ–ª—è —É–∂–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏. –ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π.

### FavoriteProfessional ‚Äî inline –¥–∞–Ω–Ω—ã–µ

**–î–æ–±–∞–≤–ª–µ–Ω—ã inline-–ø–æ–ª—è** –≤ `FavoriteProfessionalResponse`:

```typescript
interface FavoriteProfessionalResponse {
  id: string;
  userId: string;
  professionalId: string;
  professionalType: "agent" | "agency";
  // --- –ù–æ–≤—ã–µ inline-–ø–æ–ª—è ---
  name: string;              // –ò–º—è –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª–∞
  avatarUrl?: string;        // URL –∞–≤–∞—Ç–∞—Ä–∞
  companyName?: string;      // –ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏
  phone?: string;            // –¢–µ–ª–µ—Ñ–æ–Ω
  // -------------------------
  viewedAt: string;
  contactRequestedAt?: string;
  messagesSent: number;
  reviewWritten: boolean;
  createdAt: string;
  updatedAt: string;
}
```

### –ß—Ç–æ –Ω—É–∂–Ω–æ –∑–Ω–∞—Ç—å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥—É

- –ü–æ–ª—è `name`, `avatarUrl`, `companyName`, `phone` –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è inline ‚Äî –Ω–µ –Ω—É–∂–µ–Ω –æ—Ç–¥–µ–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å –∫ `/contacts/:id`
- `name` ‚Äî –≤—Å–µ–≥–¥–∞ —Å—Ç—Ä–æ–∫–∞ (–º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç–æ–π –µ—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –Ω–µ –∑–∞–ø–æ–ª–Ω–µ–Ω—ã)
- `avatarUrl`, `companyName`, `phone` ‚Äî –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ (–æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –≤ JSON –µ—Å–ª–∏ null)

---

## 7. –ö–ª–∞—Å—Ç–µ—Ä—ã –Ω–∞ –∫–∞—Ä—Ç–µ: property_ids –≤ feature properties

**–°—Ç–∞—Ç—É—Å:** üîÑ in discussion  
**–§–∞–∑–∞:** 4 ¬∑ –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: –≤—ã—Å–æ–∫–∏–π

### –¢–µ–∫—É—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

–ë–µ–∫–µ–Ω–¥ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç MVT —Ç–∞–π–ª—ã —á–µ—Ä–µ–∑ PostGIS:
- `z ‚â§ 15` ‚Äî –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —Ç–∞–π–ª—ã (ST_ClusterDBSCAN)
- `z > 15` ‚Äî –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã

### –¢–µ–∫—É—â–∏–µ feature properties –≤ –∫–ª–∞—Å—Ç–µ—Ä–∞—Ö

–ö–ª–∞—Å—Ç–µ—Ä–Ω—ã–µ —Ç–∞–π–ª—ã —Å–µ–π—á–∞—Å —Å–æ–¥–µ—Ä–∂–∞—Ç:
- `point_count` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–±—ä–µ–∫—Ç–æ–≤ –≤ –∫–ª–∞—Å—Ç–µ—Ä–µ
- `cluster_id` ‚Äî ID –∫–ª–∞—Å—Ç–µ—Ä–∞

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è

–î–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞ –∫–ª–∏–∫–∞ –ø–æ –∫–ª–∞—Å—Ç–µ—Ä—É –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç—Å—è:

1. **–ú–∞–ª—ã–µ –∫–ª–∞—Å—Ç–µ—Ä—ã (‚â§ 50 –æ–±—ä–µ–∫—Ç–æ–≤):** –î–æ–±–∞–≤–∏—Ç—å `property_ids: string[]` –≤ feature properties MVT —Ç–∞–π–ª–∞
2. **–ë–æ–ª—å—à–∏–µ –∫–ª–∞—Å—Ç–µ—Ä—ã (> 50):** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `cluster_id` + –æ—Ç–¥–µ–ª—å–Ω—ã–π —ç–Ω–¥–ø–æ–∏–Ω—Ç `GET /api/v1/properties/cluster/:cluster_id/items`

–§—Ä–æ–Ω—Ç–µ–Ω–¥ –º–æ–∂–µ—Ç —É–∂–µ —Å–µ–π—á–∞—Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `include_ids` –ø–∞—Ä–∞–º–µ—Ç—Ä –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –æ–±—ä–µ–∫—Ç–æ–≤ –∏–∑ –∫–ª–∞—Å—Ç–µ—Ä–∞, –µ—Å–ª–∏ `property_ids` –¥–æ—Å—Ç—É–ø–Ω—ã.

---

## 8. Marker type "viewed" / "unviewed" –≤ —Ñ–∏–ª—å—Ç—Ä–∞—Ö

**–°—Ç–∞—Ç—É—Å:** ‚úÖ done  
**–§–∞–∑–∞:** 6 ¬∑ –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: –Ω–∏–∑–∫–∏–π

### –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ

–î–æ–±–∞–≤–ª–µ–Ω query parameter `viewed` –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–Ω–æ—Å—Ç–∏:

```
GET /api/v1/properties/short-listing?viewed=true    ‚Äî —Ç–æ–ª—å–∫–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–Ω—ã–µ
GET /api/v1/properties/short-listing?viewed=false   ‚Äî —Ç–æ–ª—å–∫–æ –Ω–µ–ø—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–Ω—ã–µ
GET /api/v1/properties/enriched-listing?viewed=true  ‚Äî —Ç–æ–ª—å–∫–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–Ω—ã–µ
```

### –ß—Ç–æ –Ω—É–∂–Ω–æ –∑–Ω–∞—Ç—å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥—É

- –ü–∞—Ä–∞–º–µ—Ç—Ä `viewed` —Ä–∞–±–æ—Ç–∞–µ—Ç **—Ç–æ–ª—å–∫–æ –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π** (—Ç—Ä–µ–±—É–µ—Ç—Å—è user_id –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–Ω–æ—Å—Ç–∏)
- –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω –∏ –ø–µ—Ä–µ–¥–∞–ª `viewed` ‚Äî –ø–∞—Ä–∞–º–µ—Ç—Ä –±—É–¥–µ—Ç –ø—Ä–æ–∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω
- `viewed=true` ‚Äî —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç –æ–±—ä–µ–∫—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞–ª
- `viewed=false` ‚Äî —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç –æ–±—ä–µ–∫—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –µ—â—ë –Ω–µ –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞–ª

### –ò–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

- `internal/domain/property/entity.go` ‚Äî –¥–æ–±–∞–≤–ª–µ–Ω—ã –ø–æ–ª—è `Viewed *bool` –∏ `UserID *uuid.UUID` –≤ `PropertyFilter`
- `internal/delivery/http/v1/property/mapper.go` ‚Äî –ø–∞—Ä—Å–∏–Ω–≥ `viewed` query parameter

---

## –°–≤–æ–¥–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π

| # | –ó–∞–ø—Ä–æ—Å | –°—Ç–∞—Ç—É—Å | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
|---|--------|--------|-------------|
| 1 | –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ä–æ–ª–µ–π | ‚úÖ done | –î–æ–±–∞–≤–ª–µ–Ω—ã agent, agency, developer |
| 2 | –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ Tab + Filter | ‚úÖ done | –î–æ–±–∞–≤–ª–µ–Ω filterId –≤ TabResponse |
| 3 | Autosearch "online" | ‚úÖ done | –î–æ–±–∞–≤–ª–µ–Ω send_frequency=online |
| 4 | –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –∞—Ç—Ä–∏–±—É—Ç–æ–≤ | ‚úÖ done | –£–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ, –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π |
| 5 | Guest-–≥–µ–æ–º–µ—Ç—Ä–∏–∏ | ‚úÖ done | –ù–æ–≤—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã /filters/guest/geometry |
| 6 | FavoriteProfessional inline | ‚úÖ done | –î–æ–±–∞–≤–ª–µ–Ω—ã name, avatarUrl, companyName, phone |
| 7 | –ö–ª–∞—Å—Ç–µ—Ä—ã property_ids | üîÑ in discussion | –¢—Ä–µ–±—É–µ—Ç—Å—è –∏–∑–º–µ–Ω–µ–Ω–∏–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ MVT —Ç–∞–π–ª–æ–≤ |
| 8 | viewed/unviewed —Ñ–∏–ª—å—Ç—Ä | ‚úÖ done | –î–æ–±–∞–≤–ª–µ–Ω query param viewed=true/false |

---

## –ù–æ–≤—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã (–ø—É–±–ª–∏—á–Ω—ã–µ)

| –ú–µ—Ç–æ–¥ | –ü—É—Ç—å | Auth | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|------|------|----------|
| `POST` | `/filters/guest/geometry` | ‚ùå | –°–æ–∑–¥–∞—Ç—å guest-–≥–µ–æ–º–µ—Ç—Ä–∏—é |
| `GET` | `/filters/guest/geometry/:id` | ‚ùå | –ü–æ–ª—É—á–∏—Ç—å guest-–≥–µ–æ–º–µ—Ç—Ä–∏—é |
| `DELETE` | `/filters/guest/geometry/:id` | ‚ùå | –£–¥–∞–ª–∏—Ç—å guest-–≥–µ–æ–º–µ—Ç—Ä–∏—é |

## –û–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–µ —Ç–∏–ø—ã

### UserResponse.role (—Ä–∞—Å—à–∏—Ä–µ–Ω)

```typescript
role: "user" | "agent" | "agency" | "developer" | "admin"
```

### Autosearch send_frequency (—Ä–∞—Å—à–∏—Ä–µ–Ω)

```typescript
send_frequency: "online" | "instant" | "daily" | "weekly"
```

### Property listing query params (–Ω–æ–≤—ã–π)

```
viewed=true|false  ‚Äî —Ñ–∏–ª—å—Ç—Ä –ø–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–Ω–æ—Å—Ç–∏ (—Ç—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏)
```

---

## Changelog

| –î–∞—Ç–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|----------|
| 2026-02-16 | –ü–µ—Ä–≤–∏—á–Ω–æ–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–∏ —Å–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–∏ Integration Plan |
| 2026-02-16 | –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ 1-8, —Å–æ–∑–¥–∞–Ω–∏–µ –æ—Ç—á—ë—Ç–∞ |
