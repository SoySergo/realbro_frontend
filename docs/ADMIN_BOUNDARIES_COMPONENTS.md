# –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤–µ–∫—Ç–æ—Ä–Ω—ã—Ö —Ç–∞–π–ª–æ–≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã—Ö –≥—Ä–∞–Ω–∏—Ü

## –û–±–∑–æ—Ä

–°–æ–∑–¥–∞–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã—Ö –≥—Ä–∞–Ω–∏—Ü –∏–∑ –≤–µ–∫—Ç–æ—Ä–Ω—ã—Ö PBF —Ç–∞–π–ª–æ–≤ –Ω–∞ –∫–∞—Ä—Ç–µ Mapbox.

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

### 1. **AdminBoundariesMap** (`src/components/features/map/AdminBoundariesMap.tsx`)

–û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –∫–∞—Ä—Ç—ã —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –≤–µ–∫—Ç–æ—Ä–Ω—ã—Ö —Ç–∞–π–ª–æ–≤.

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Mapbox
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Å–≤–µ—Ç–ª–æ–π –∏ —Ç—ë–º–Ω–æ–π —Ç–µ–º—ã
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Ö—É–∫–æ–º `useAdminBoundaries`
- –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –∫–ª–∏–∫–∞ –∏ –Ω–∞–≤–µ–¥–µ–Ω–∏—è

**Props:**
```typescript
{
    tileSource: TileSourceConfig;        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏—Å—Ç–æ—á–Ω–∏–∫–∞ —Ç–∞–π–ª–æ–≤
    center?: [number, number];           // –¶–µ–Ω—Ç—Ä –∫–∞—Ä—Ç—ã [lng, lat]
    zoom?: number;                       // –ù–∞—á–∞–ª—å–Ω—ã–π –∑—É–º
    minZoom?: number;                    // –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –∑—É–º
    maxZoom?: number;                    // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –∑—É–º
    styles?: BoundaryStyles;             // –°—Ç–∏–ª–∏ –¥–ª—è –≥—Ä–∞–Ω–∏—Ü
    showControls?: boolean;              // –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –∫–æ–Ω—Ç—Ä–æ–ª—ã –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
    onBoundaryClick?: (feature) => void; // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞
    onBoundaryHover?: (feature) => void; // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–∞–≤–µ–¥–µ–Ω–∏—è
    className?: string;                  // CSS –∫–ª–∞—Å—Å
}
```

### 2. **useAdminBoundaries** (`src/hooks/useAdminBoundaries.ts`)

–•—É–∫ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–ª–æ—è–º–∏ –≤–µ–∫—Ç–æ—Ä–Ω—ã—Ö —Ç–∞–π–ª–æ–≤ –Ω–∞ –∫–∞—Ä—Ç–µ.

**–§—É–Ω–∫—Ü–∏–∏:**
- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ —Å–ª–æ—ë–≤ –≥—Ä–∞–Ω–∏—Ü
- –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏–π –º—ã—à–∏
- –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ –ø—Ä–∏ —Ä–∞–∑–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```typescript
const { sourceId, fillLayerId, lineLayerId } = useAdminBoundaries({
    map: mapInstance,
    config: {
        url: 'https://your-r2.dev/tiles/{z}/{x}/{y}.pbf',
        sourceLayer: 'boundaries',
        minZoom: 0,
        maxZoom: 14,
    },
    styles: {
        fillColor: '#3b82f6',
        fillOpacity: 0.2,
        lineColor: '#2563eb',
        lineWidth: 2,
        lineOpacity: 0.8,
    },
    enabled: true,
    onBoundaryClick: (feature) => console.log(feature),
});
```

### 3. **TilesTestClient** (`src/app/[locale]/tiles-test/TilesTestClient.tsx`)

–¢–µ—Å—Ç–æ–≤—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤–µ–∫—Ç–æ—Ä–Ω—ã—Ö —Ç–∞–π–ª–æ–≤.

**–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**
- –ó–∞–≥—Ä—É–∑–∫–∞ –∏ –ø–∞—Ä—Å–∏–Ω–≥ PBF —Ç–∞–π–ª–æ–≤
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∏–º–µ–Ω–∏ —Å–ª–æ—è
- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Ç–∞–π–ª–∞ (—Å–ª–æ–∏, —Å–≤–æ–π—Å—Ç–≤–∞, —Ç–∏–ø—ã –≥–µ–æ–º–µ—Ç—Ä–∏–∏)
- –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –∫–∞—Ä—Ç–∞ —Å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞–º–∏ —Å–æ–±—ã—Ç–∏–π

**–ß—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∞–Ω–∞–ª–∏–∑ —Ç–∞–π–ª–∞:**
- –†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞
- Content-Type
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–ª–æ—ë–≤
- –î–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–ª–æ—è:
  - –ù–∞–∑–≤–∞–Ω–∏–µ
  - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ features
  - –¢–∏–ø—ã –≥–µ–æ–º–µ—Ç—Ä–∏–∏ (Point, LineString, Polygon)
  - –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Å–≤–æ–π—Å—Ç–≤
  - Extent –∏ Version

## –¢–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö

### TileSourceConfig
```typescript
{
    url: string;              // URL —à–∞–±–ª–æ–Ω: '{z}/{x}/{y}.pbf'
    sourceLayer: string;      // –ò–º—è —Å–ª–æ—è –≤ PBF —Ñ–∞–π–ª–µ
    minZoom?: number;         // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é 0
    maxZoom?: number;         // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é 14
}
```

### BoundaryStyles
```typescript
{
    fillColor?: string;       // –¶–≤–µ—Ç –∑–∞–ª–∏–≤–∫–∏ (hex)
    fillOpacity?: number;     // –ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å –∑–∞–ª–∏–≤–∫–∏ (0-1)
    lineColor?: string;       // –¶–≤–µ—Ç –≥—Ä–∞–Ω–∏—Ü—ã (hex)
    lineWidth?: number;       // –®–∏—Ä–∏–Ω–∞ –ª–∏–Ω–∏–∏ (px)
    lineOpacity?: number;     // –ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å –ª–∏–Ω–∏–∏ (0-1)
}
```

### BoundaryFeatureData
```typescript
{
    id?: string | number;
    properties: Record<string, unknown>;
    geometry: {
        type: 'Polygon' | 'MultiPolygon';
        coordinates: number[][][] | number[][][][];
    };
}
```

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ë–∞–∑–æ–≤—ã–π –ø—Ä–∏–º–µ—Ä

```typescript
import { AdminBoundariesMap } from '@/components/features/map/AdminBoundariesMap';

function MyPage() {
    return (
        <AdminBoundariesMap
            tileSource={{
                url: 'https://your-tiles.r2.dev/tiles/{z}/{x}/{y}.pbf',
                sourceLayer: 'boundaries',
            }}
            center={[2.1734, 41.3851]}
            zoom={10}
            onBoundaryClick={(feature) => {
                console.log('Clicked:', feature.properties);
            }}
        />
    );
}
```

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–∞–π–ª–æ–≤

1. –û—Ç–∫—Ä–æ–π—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É `/tiles-test`
2. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "üîç –ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ç–∞–π–ª 0/0/0"
3. –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å–ª–æ—è—Ö –≤ –ª–µ–≤–æ–π –ø–∞–Ω–µ–ª–∏
4. –ö–∞—Ä—Ç–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∑–∏—Ç—Å—è —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º –∏–º–µ–Ω–µ–º —Å–ª–æ—è
5. –ö–ª–∏–∫–∞–π—Ç–µ –Ω–∞ –≥—Ä–∞–Ω–∏—Ü—ã –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –¥–∞–Ω–Ω—ã—Ö

## –û—Ç–ª–∞–¥–∫–∞

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç –ø—Ä–µ—Ñ–∏–∫—Å—ã –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è:
- `[AdminBoundariesMap]` - –æ—Å–Ω–æ–≤–Ω–æ–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –∫–∞—Ä—Ç—ã
- `[AdminBoundaries]` - —Ö—É–∫ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–ª–æ—è–º–∏
- `[TileAnalyzer]` - –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä —Ç–∞–π–ª–æ–≤

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–∞–π–ª–æ–≤

–í –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞ —Å–º–æ—Ç—Ä–∏—Ç–µ:
1. –£—Å–ø–µ—à–Ω–æ—Å—Ç—å –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–∞–π–ª–æ–≤
2. –ò–º–µ–Ω–∞ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Å–ª–æ—ë–≤
3. –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ features –≤ –∫–∞–∂–¥–æ–º —Å–ª–æ–µ
4. CORS –∑–∞–≥–æ–ª–æ–≤–∫–∏

### –¢–∏–ø–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

**–¢–∞–π–ª—ã –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ CORS –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ R2 bucket
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ URL —Ç–∞–π–ª–æ–≤ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–º—è —Å–ª–æ—è —á–µ—Ä–µ–∑ –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä
4. –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ Network tab –≤ DevTools

**–û—à–∏–±–∫–∞ "source layer not found":**
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä —Ç–∞–π–ª–æ–≤ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –∏–º–µ–Ω–∏ —Å–ª–æ—è

**WebGL errors:**
- –ü—Ä–æ–±–ª–µ–º–∞ —Å Firefox –∏ WebGL context - –æ–±—ã—á–Ω–æ –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ
- –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

### –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
```json
{
    "mapbox-gl": "^3.16.0",
    "pbf": "^4.0.1",
    "@mapbox/vector-tile": "^2.0.4",
    "next-themes": "^0.4.6"
}
```

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
```env
NEXT_PUBLIC_MAPBOX_TOKEN=your_mapbox_token
```

## CORS –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–ª—è R2

–î–æ–±–∞–≤—å—Ç–µ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ bucket:
```json
[
  {
    "AllowedOrigins": ["*"],
    "AllowedMethods": ["GET", "HEAD"],
    "AllowedHeaders": ["*"],
    "ExposeHeaders": ["ETag", "Content-Length", "Content-Type"],
    "MaxAgeSeconds": 3600
  }
]
```

–ü–æ–¥—Ä–æ–±–Ω–µ–µ: `docs/R2_TILES_CORS_SETUP.md`

## –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

- –¢–∞–π–ª—ã –∫–µ—à–∏—Ä—É—é—Ç—Å—è –±—Ä–∞—É–∑–µ—Ä–æ–º
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–µ–∫—Ç–æ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç (–º–µ–Ω—å—à–µ —Ä–∞–∑–º–µ—Ä)
- Lazy loading –ø—Ä–∏ –∑—É–º–µ/–ø–∞–Ω–æ—Ä–∞–º–∏—Ä–æ–≤–∞–Ω–∏–∏
- –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ –ø–∞–º—è—Ç—å

## –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ

–î–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π:

1. **–ö–∞—Å—Ç–æ–º–Ω—ã–µ —Å—Ç–∏–ª–∏** - –ø–µ—Ä–µ–¥–∞–π—Ç–µ `styles` prop
2. **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è** - –¥–æ–±–∞–≤—å—Ç–µ filter expression –≤ —Ö—É–∫
3. **–ü–æ–ø–∞–ø—ã** - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `onBoundaryClick`
4. **–ü–æ–∏—Å–∫** - –¥–æ–±–∞–≤—å—Ç–µ –ø–æ–∏—Å–∫ –ø–æ properties

## –°–≤—è–∑–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

- `/src/types/tiles.ts` - TypeScript —Ç–∏–ø—ã
- `/src/types/boundary.ts` - —Ç–∏–ø—ã –≥—Ä–∞–Ω–∏—Ü (legacy)
- `/docs/R2_TILES_CORS_SETUP.md` - –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ CORS
- `/my-app/src/app/[locale]/tiles-test/` - —Ç–µ—Å—Ç–æ–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
