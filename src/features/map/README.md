# Feature: Map

Базовые компоненты интерактивной карты для различных целей в приложении.

## Структура

```
map/
├── ui/
│   ├── base-map/        # Базовая карта Mapbox с инициализацией
│   └── search-map/      # Карта для страницы поиска с фильтрацией
├── index.ts
└── README.md
```

## Компоненты

### BaseMap

Базовый компонент карты Mapbox. Инициализирует карту и передаёт инстанс через колбэк.

**Props:**
- `initialCenter?: [number, number]` - начальный центр карты [lng, lat]
- `initialZoom?: number` - начальный зуум
- `onMapLoad?: (map: mapboxgl.Map) => void` - колбэк при инициализации карты
- `className?: string` - CSS классы для контейнера
- `children?: React.ReactNode` - дочерние элементы (панели управления поверх карты)

**Использование:**
```tsx
import { BaseMap } from '@/features/map';

function MyMap() {
  const handleMapLoad = (map: mapboxgl.Map) => {
    console.log('Map loaded', map);
  };

  return (
    <BaseMap onMapLoad={handleMapLoad}>
      <div>Панель управления</div>
    </BaseMap>
  );
}
```

### SearchMap

Компонент карты для страницы поиска недвижимости. Управляет отображением режимов фильтра локации и маркерами недвижимости.

**Логика:**
- Если активен режим фильтра локации (search/draw/isochrone/radius) - показывает панель управления
- Если режим НЕ активен - показывает маркеры недвижимости на карте (TODO)

**Props:**
- `initialCenter?: [number, number]` - начальный центр карты [lng, lat]
- `initialZoom?: number` - начальный зуум

**Использование:**
```tsx
import { SearchMap } from '@/features/map';

function SearchPage() {
  return <SearchMap />;
}
```

## Зависимости

- `@/features/location-filter` - контроллер режимов фильтрации локации
- `@/store/filterStore` - глобальное состояние фильтров
- `@/shared/lib/mapbox` - конфигурация Mapbox
- `mapbox-gl` - библиотека карт

## TODO (будущее)

- [ ] **PropertyMarkers** - слой маркеров недвижимости на карте
- [ ] **POIMarkers** - слой точек интереса (Points of Interest)
- [ ] **ClusterMarkers** - кластеризация маркеров при большом количестве
- [ ] **HeatmapLayer** - тепловая карта цен/плотности объектов
- [ ] Добавить другие типы слоёв по необходимости

## Архитектурные решения

1. **BaseMap** - максимально простой и переиспользуемый компонент
   - Инициализирует карту Mapbox
   - Передаёт инстанс через колбэк
   - Позволяет рендерить дочерние элементы поверх карты

2. **SearchMap** - специализированная карта для страницы поиска
   - Интегрируется с location-filter feature
   - Управляет отображением слоёв в зависимости от состояния
   - В будущем будет управлять слоями недвижимости и POI

3. **Расширяемость**
   - Легко добавлять новые специализированные карты (HomeMap, ProfileMap и т.д.)
   - Все используют BaseMap как основу
   - Слои выносятся в отдельные компоненты для переиспользования
